var x=Object.defineProperty;var H=(t,r,e)=>r in t?x(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e;var E=(t,r,e)=>H(t,typeof r!="symbol"?r+"":r,e);import{R as F,a as d}from"./react-vendor-Cro0ICLZ.js";function M(t){const[r,e]=d.useState(!0),[a,o]=d.useState(null),[n,s]=d.useState(!1),l=()=>{e(!1),s(!0)};return d.useEffect(()=>{if(!document){const g=new Error(`[ScriptLoadingError] document not defined when attempting to load ${t}`);o(g);return}const c=document.querySelector(`script[src="${t}"]`);if(c!=null&&c.dataset.loaded){l();return}const i=c||document.createElement("script");c||(i.src=t);const m=()=>{i.dataset.loaded="1",l()};i.addEventListener("load",m),i.addEventListener("error",g=>{console.error("Failed to load script:",t,g);const h=new Error(`[ScriptLoadingError] Failed to load script: ${t}`);o(h)}),c||document.head.append(i)},[]),{isLoading:r,error:a,isSuccess:n}}const Q=t=>t&&t.charts,q=(t,r)=>{const{controls:e,toolbarItems:a,getChartEditor:o}=t;return r&&r.charts&&r.visualization&&r.visualization.ChartWrapper&&r.visualization.Dashboard&&(!e||r.visualization.ChartWrapper)&&(!o||r.visualization.ChartEditor)&&(!a||r.visualization.drawToolbar)},V=t=>window.google;function j(t){const{chartVersion:r="current",chartPackages:e=["corechart","controls"],chartLanguage:a="en",mapsApiKey:o}=t,[n,s]=d.useState(null),[l,c]=d.useState(null),[i,m]=d.useState(null),{isLoading:g,error:h,isSuccess:u}=M(t.chartLoaderScriptUrl||"https://www.gstatic.com/charts/loader.js");return d.useEffect(()=>{if(!u)return;const C=V();if(!Q(C)){const y=new Error("[ScriptInitializationError] Script loaded but Google not attached to window.");c(y);return}if(q(t,C)){s(C);return}C.charts.load(r,{packages:e,language:a,mapsApiKey:o}),C.charts.setOnLoadCallback(()=>{if(!q(t,C)){const y=new Error("[GoogleChartsInitializationError] Google Charts not ready after load callback.");console.error(y),m(y);return}s(C)})},[u]),{error:h||l||i,isLoading:g,google:n}}const N={legend_toggle:!1,options:{},legendToggle:!1,getChartWrapper:()=>{},spreadSheetQueryParameters:{headers:1,gid:1},rootProps:{},chartWrapperParams:{},chartLoaderScriptUrl:"https://www.gstatic.com/charts/loader.js"},K=t=>{const{isReady:r,chartControls:e,filter:a}=t;return!r||!e||!(e!=null&&e.length)?null:F.createElement(F.Fragment,null,e.filter(o=>{let{controlProp:n,control:s}=o;return a?a({control:s,controlProp:n}):!0}).map(o=>{let{control:n}=o;return F.createElement("div",{key:n.getContainerId(),id:n.getContainerId()})}))};let U=0;const k=()=>(U+=1,`reactgooglegraph-${U}`),z=class z{};E(z,"initializeControls",r=>{for(let e=0;e<r.length;e+=1){const{controlType:a,options:o,controlWrapperParams:n}=r[e].controlProp;n&&"state"in n&&r[e].control.setState(n.state),r[e].control.setOptions(o),r[e].control.setControlType(a)}}),E(z,"listenToControlEvents",(r,e)=>{const{google:a}=e;return r.flatMap(o=>{const{control:n,controlProp:s}=o,{controlEvents:l=[]}=s;return l.map(c=>{const{callback:i,eventName:m}=c;return a.visualization.events.addListener(n,m,function(){for(var g=arguments.length,h=new Array(g),u=0;u<g;u++)h[u]=arguments[u];i({chartWrapper:null,controlWrapper:n,props:e,google:a,eventArgs:h})})})})}),E(z,"createControlId",r=>{let e;return typeof r>"u"?e=`googlechart-control-${k()}`:e=r,e}),E(z,"createChartControls",r=>{const{controls:e,google:a}=r;return e?e.map((o,n)=>{const{controlID:s,controlType:l,options:c,controlWrapperParams:i}=o,m=z.createControlId(s);return{controlProp:o,control:new a.visualization.ControlWrapper({containerId:m,controlType:l,options:c,...i})}}):null}),E(z,"addControls",r=>{const{chartWrapper:e,chartDashboard:a}=r,o=z.createChartControls(r);return!o||!a||!e?null:(a.bind(o.map(n=>{let{control:s}=n;return s}),e),z.initializeControls(o),o)});let $=z;const Y=t=>{const[r,e]=d.useState(null);return[d.useMemo(()=>!r||!t?null:t.map((o,n)=>{const s=r[n];return s?{controlProp:o,control:s}:void 0}).flatMap(o=>o?[o]:[]),[r,t]),e]},J=(t,r)=>{d.useEffect(()=>{const e=$.listenToControlEvents(t??[],r);return()=>{e.forEach(a=>{r.google.visualization.events.removeListener(a)})}},[t,r])},X=t=>{const[r,e]=Y(t.controls);return J(r??[],t),{addControls:o=>{const n=$.addControls(o);e((n==null?void 0:n.map(s=>s.control))??null)},renderControl:o=>{const{chartWrapper:n,chartDashboard:s}=t;return d.createElement(K,{...t,isReady:!!(n&&s),chartControls:r,filter:o})}}},Z=t=>{const r=d.useRef(null);return{chartId:(()=>{const{graphID:o,graph_id:n}=t,s=o||n;let l;return s?l=s:l=r.current||k(),r.current=l,r.current})()}},G=["#3366CC","#DC3912","#FF9900","#109618","#990099","#3B3EAC","#0099C6","#DD4477","#66AA00","#B82E2E","#316395","#994499","#22AA99","#AAAA11","#6633CC","#E67300","#8B0707","#329262","#5574A6","#3B3EAC"],_=async function(t,r){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((a,o)=>{const n=`${e.headers?`headers=${e.headers}`:"headers=0"}`,s=`${e.query?`&tq=${encodeURIComponent(e.query)}`:""}`,l=`${e.gid?`&gid=${e.gid}`:""}`,c=`${e.sheet?`&sheet=${e.sheet}`:""}`,i=`${e.access_token?`&access_token=${e.access_token}`:""}`,m=`${n}${l}${c}${s}${i}`,g=`${r}/gviz/tq?${m}`;new t.visualization.Query(g).send(u=>{u.isError()?o(`Error in query:  ${u.getMessage()} ${u.getDetailedMessage()}`):a(u.getDataTable())})})},tt="#CCCCCC",p=class p{};E(p,"grayOutHiddenColumnsLabel",(r,e)=>{const{googleChartWrapper:a,options:o}=r;if(!a){console.error("googleChartWrapper is not defined");return}const n=a.getDataTable();if(!n)return;const s=n.getNumberOfColumns();if(e.length>0===!1)return;const c=Array.from({length:s-1}).map((i,m)=>{const g=p.getColumnId(n,m+1);return e.includes(g)?tt:o&&o.colors?o.colors[m]:G[m]});a.setOptions({...o,colors:c}),a.draw()}),E(p,"listenToLegendToggle",(r,e)=>{const[a,o]=e,{google:n,googleChartWrapper:s}=r;if(!s){console.error("googleChartWrapper is not defined");return}return n.visualization.events.addListener(s,"select",()=>{const c=s.getChart().getSelection(),i=s.getDataTable();if(c.length===0||c[0].row!==null||!i)return;const m=c[0].column,g=p.getColumnId(i,m);a!=null&&a.includes(g)?o(h=>[...h.filter(u=>u!==g)]):o(h=>[...h,g])})}),E(p,"draw",async r=>{const{data:e,diffdata:a,rows:o,columns:n,options:s,chartType:l,formatters:c,spreadSheetUrl:i,spreadSheetQueryParameters:m,googleChartDashboard:g,googleChartWrapper:h,google:u,hiddenColumns:C,legendToggle:y,legend_toggle:W}=r;if(!h){console.error("draw was called with googleChartWrapper = null");return}let f,v=null;if(a){const S=u.visualization.arrayToDataTable(a.old),w=u.visualization.arrayToDataTable(a.new);v=u.visualization[l].prototype.computeDiff(S,w)}e?e instanceof u.visualization.DataTable?f=e:Array.isArray(e)?f=u.visualization.arrayToDataTable(e):f=new u.visualization.DataTable(e):o&&n?f=u.visualization.arrayToDataTable([n,...o]):i?f=await _(u,i,m):f=u.visualization.arrayToDataTable([]);const b=f.getNumberOfColumns(),A=Array(b).fill(0).map((S,w)=>{const I=p.getColumnId(f,w);return C.includes(I)?{label:f.getColumnLabel(w),type:f.getColumnType(w),calc:()=>null}:w}),T=h.getChart();h.getChartType()==="Timeline"&&T&&T.clearChart(),h.setChartType(l),h.setOptions(s||{});const D=new u.visualization.DataView(f);D.setColumns(A),h.setDataTable(D),h.draw(),g&&g.draw(f),v&&(h.setDataTable(v),h.draw()),c&&(p.applyFormatters({dataTable:f,formatters:c,google:u}),h.setDataTable(f),h.draw()),(y===!0||W===!0)&&p.grayOutHiddenColumnsLabel(r,C)}),E(p,"getColumnId",(r,e)=>r.getColumnId(e)||r.getColumnLabel(e)),E(p,"applyFormatters",r=>{let{dataTable:e,formatters:a,google:o}=r;for(let n of a)switch(n.type){case"ArrowFormat":{new o.visualization.ArrowFormat(n.options).format(e,n.column);return}case"BarFormat":{new o.visualization.BarFormat(n.options).format(e,n.column);return}case"ColorFormat":{const s=new o.visualization.ColorFormat(n.options),{ranges:l}=n;if(l)for(let c of l)s.addRange(...c);s.format(e,n.column);return}case"DateFormat":{new o.visualization.DateFormat(n.options).format(e,n.column);return}case"NumberFormat":{new o.visualization.NumberFormat(n.options).format(e,n.column);return}case"PatternFormat":{new o.visualization.PatternFormat(n.options).format(e,n.column);return}default:{console.warn(`Unknown formatter type: ${n.type}`);return}}});let P=p;const et=t=>{const{google:r,googleChartWrapper:e,googleChartDashboard:a}=t,[o,n]=d.useState([]);d.useEffect(()=>{e&&P.draw({...t,hiddenColumns:o,googleChartWrapper:e,googleChartDashboard:a,google:r})},[o,t.data,t.rows,t.columns,t.options,t.chartLoaderScriptUrl,t.chartType,t.formatters,t.spreadSheetUrl,t.spreadSheetQueryParameters,t.legendToggle,t.legend_toggle]);const s=()=>{const{googleChartWrapper:i}=t;i&&i.draw()},l=i=>{const m=[],{legendToggle:g,legend_toggle:h}=t;if(P.draw({...t,hiddenColumns:o,googleChartWrapper:i,googleChartDashboard:a,google:r}),window.addEventListener("resize",s),h||g){const u=P.listenToLegendToggle(t,[o,n]);u&&m.push(u)}return m},c=(i,m)=>{window.removeEventListener("resize",s),m.forEach(g=>{r.visualization.events.removeListener(g)}),i.getChartType()==="Timeline"&&i.getChart()&&i.getChart().clearChart()};d.useEffect(()=>{if(!e)return;const i=l(e);return()=>{c(e,i)}},[e,l,c])},rt=t=>{const{chartEvents:r,google:e,googleChartWrapper:a}=t;if(r){if(!a){console.warn("listenToEvents was called before chart wrapper ready.");return}return r.map(o=>{let{eventName:n,callback:s}=o;return e.visualization.events.addListener(a,n,function(){for(var l=arguments.length,c=new Array(l),i=0;i<l;i++)c[i]=arguments[i];s({chartWrapper:a,props:t,google:e,eventArgs:c})})})}},ot=t=>{d.useEffect(()=>{if(!t.googleChartWrapper)return;const r=rt(t);return()=>{r==null||r.forEach(e=>{t.google.visualization.events.removeListener(e)})}},[t])},nt=t=>{const[r,e]=d.useState(null),[a,o]=d.useState(null),{addControls:n,renderControl:s}=X({...t,chartDashboard:a,chartWrapper:r});ot({...t,googleChartWrapper:r});const{chartId:l}=Z(t),c=d.useRef(null),i=d.useRef(null);d.useEffect(()=>{const{options:f,google:v,chartType:b,chartWrapperParams:A,toolbarItems:T,getChartEditor:D,getChartWrapper:S,onLoad:w}=t,I={chartType:b,options:f,containerId:l,...A},L=new v.visualization.ChartWrapper(I);L.setOptions(f||{}),S==null||S(L,v);const O=new v.visualization.Dashboard(c.current);T&&v.visualization.drawToolbar(i.current,T);let R=null;D&&(R=new v.visualization.ChartEditor,D({chartEditor:R,chartWrapper:L,google:v})),n({...t,chartDashboard:O,chartWrapper:L}),e(L),o(O),w==null||w(v,{google:v,chartWrapper:L,chartEditor:R,chartDashboard:O})},[]),et({...t,googleChartWrapper:r,googleChartDashboard:a});const m=()=>{const{width:f,height:v,options:b,style:A,className:T,rootProps:D,google:S}=t,w={height:v||b&&b.height,width:f||b&&b.width,...A};return d.createElement("div",{id:l,style:w,className:T,...D})},g=()=>t.toolbarItems?d.createElement("div",{ref:i}):null,{width:h,height:u,options:C,style:y}=t,W={height:u||C&&C.height,width:h||C&&C.width,...y};return t.render?d.createElement("div",{ref:c,style:W},d.createElement("div",{ref:i,id:"toolbar"}),t.render({renderChart:m,renderControl:s,renderToolbar:g})):d.createElement("div",{ref:c,style:W},s(f=>{let{controlProp:v}=f;return v.controlPosition!=="bottom"}),m(),s(f=>{let{controlProp:v}=f;return v.controlPosition==="bottom"}),g())},at=d.createContext(N),st=t=>{let{children:r,value:e}=t;return d.createElement(at.Provider,{value:e},r)},it=t=>{const{google:r,isLoading:e,error:a}=j(t);return e?t.loader??null:a?t.errorElement??null:r?F.createElement(nt,{google:r,...t}):null},ut=t=>{const r={...N,...t};return F.createElement(st,{value:r},F.createElement(it,r))};var B;(function(t){t.annotation="annotation",t.annotationText="annotationText",t.certainty="certainty",t.emphasis="emphasis",t.interval="interval",t.scope="scope",t.style="style",t.tooltip="tooltip",t.domain="domain"})(B||(B={}));export{ut as C};
